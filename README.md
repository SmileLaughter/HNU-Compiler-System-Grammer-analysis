# 语法分析器项目（Grammar Analysis）

本项目用于 HNU 编译系统课程的语法分析部分，包含从文法解析、FIRST/FOLLOW 集计算、LL/LR 系列分析器、DFA 导出与可视化、以及推导（最左/最右）生成与比较等功能。

## UI 展示
<img src="assets\image.png" alt="集合计算" width="40%" title="标题">

<img src="assets\image1.png" alt="算法选择" width="100%" title="标题">

<img src="assets\image2.png" alt="LR 分析表" width="100%" title="标题">



## 0. 免责声明（重要，必读）

目前本项目**只有 LR(1) 算法**进行了人工验证，确保了正确性。

其他的算法请同学们自行验证正确性后，再于考试中使用。如果因为程序出错而导致考试失分，本人概不负责。（其实其他功能我大概也验证了一下，只是不能确保 100% 正确 (●'◡'●) 

如果有同学人工验证了其他算法的正确性，也欢迎提 PR

此外，由于拔尖班的编译课程可能和其他专业在细节处的格式**略有差异**，请同学们自行甄别，但整体逻辑肯定是一样的。如有需要可以再让 AI 进行修改，或者在运行程序后人工修改。


## 1. 运行与入口

安装环境:
```
pip install -r requirements.txt
```

在项目根目录（`Chp 3 Grammer analysis`）下运行主程序：

```powershell
python main.py
```

## 2. 输入文件格式（文法与句子）

项目使用文件输入形式，支持“文法文件 + 句子”格式：

- 将要测试的文法与句子放在 input 文件夹下，任意一个 `.txt` 文件中，使用 `%%` 分隔符将文法部分和句子部分隔开：

```
S : + S S
S : * S S
S : a

%%

+*aaa
```

- 文法部分：每行一个产生式，推荐格式为：
  - `A : α` 或 `A -> α`
  - 左部为非终结符名，右部为以空格分隔的符号序列（终结符或非终结符），或不含空格时按字符解析
  - 支持 `ε`（或空右部）表示空串产生式

- 句子（测试串）部分：每行一个句子
  - 如果句子用空格分隔符，例如：`id + id * id`，程序会按空格分割为符号列表
  - 如果句子中没有空格（例如 `+*aaa`），程序会将其按字符拆分为符号序列：`['+', '*', 'a', 'a', 'a']`
  - 注释行以 `#` 开头将被忽略

## 3. 交互选项（启动时）

启动 `main.py` 时，程序会先询问：

- DFA 生成模式：确定性（默认）或非确定性（略微更快但输出可能不可重现）
  - 确定性：该模式下，对于同一个文法，运行多次程序得到的 DFA 是一模一样的。可以用于平常的作业、题目等。
  - 非确定性：该模式下，对于同一个文法，运行多次程序得到的 DFA 是同构的。可以直接用于考试，这样老师就不能判你抄袭了(●'◡'●)

## 4. 配置文件说明 (config.py)

项目根目录下包含一个 `config.py` 文件，您可以修改其中的变量来控制程序的默认行为，从而跳过繁琐的交互询问。

支持的配置项包括：
1.  **DETERMINISTIC_MODE_CONFIG**：是否启用确定性模式
2.  **GENERATE_DFA_IMAGE_CONFIG**：是否生成 DFA 图片
3.  **EXPORT_DFA_JSON_CONFIG**：是否导出 DFA 为 JSON

每个配置项支持三个值：
- `1` (ConfigMode.ALWAYS_YES)：默认行为为是（自动执行，不询问）
- `2` (ConfigMode.ALWAYS_NO)：默认行为为否（自动跳过，不询问）
- `3` (ConfigMode.ASK_USER)：由用户输入决定（默认值）

## 5. 输出内容及形式

- 大部分结果在终端直接输出
- 支持将 DFA 导出成图片，位于 `output/DFA` 目录下
- 推导树、语法树的图片也位于 `output` 目录下
- DFA 导出（JSON）：导出位置默认 `output/dfa_data/`

## 6. 项目内容与作用

主要功能：

- 解析上下文无关文法（CFG），计算 NULLABLE / FIRST / FOLLOW 集
- 支持多种语法分析算法：LL(1)、LR(0)、SLR、LR(1)、LALR(1)
- 自动（可选）对不满足 LL(1) 的文法尝试转换（提取左公因子、消除左递归等）
- 构造 LR 项集规范族（DFA），并支持导出为 JSON（用于存储和后续比较）
- DFA 同构性检查（比较不同生成器/算法导出的 DFA 是否同构）
- 生成并可视化最左推导 / 最右推导（支持通用回溯算法，可处理任意 CFG）
- 交互式命令行界面（使用 Rich 美化显示）

## 7. 辅助功能介绍

对于本项目导出的 DFA 格式，可以使用 `dfa_isomorphism_checker.py` 文件验证多个 DFA 是否同构。

具体用法：
`python dfa_isomorphism_checker.py`

该程序允许选择要比较哪一个算法的 DFA，然后会自动（递归地）搜索当前文件夹及子文件夹下的所有包含该算法名称的 json 文件，然后验证它们是否同构。

